<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>RL-MM</title>
    <link rel="shortcut icon" type="image/x-icon" href="img/favicon.ico">

    <link rel="stylesheet" href="css/hint.min.css" type="text/css"/>

    <link rel="stylesheet" href="css/index.css" type="text/css"/>
    <link rel="stylesheet" href="css/mapList.css" type="text/css"/>
    <link rel="stylesheet" href="css/configuration.css" type="text/css"/>

    <script src="js/jquery-3.5.1.min.js" type="application/javascript"></script>

    <script src="js/index.js" type="application/javascript"></script>
    <script src="js/mapDiscovery.js" type="application/javascript"></script>
    <script src="js/mapList.js" type="application/javascript"></script>
    <script src="js/configuration.js" type="application/javascript"></script>
</head>
<body>
<div id="header">
    <div class="headerLeft">
        <img src="img/logo.png" alt="Logo"/>
    </div>
    <div class="headerRight">
        <div style="font-size: 30px">
            Rocket League - Map Manager
        </div>
        <div style="font-size: 20px">
            Made by Yggdrasil128
        </div>
        <div id="versionDiv" style="font-size: 16px; margin-top: 10px">
            Version:
        </div>
    </div>
</div>
<div id="navBar">
    <div class="navList">
        <div class="anchor current" data-divID="contentHome">Home</div>
        <div class="anchor" data-divID="contentMapList">Map List</div>
        <div class="anchor setupHint hint--bottom-right hint--always hint--rounded hint--warning"
             data-divID="contentConfiguration"
             data-hint="The Steam library isn't configured yet. Please click here.">
            Configuration
        </div>
    </div>
    <div class="navExtra">
        <table>
            <tr>
                <td>Local time:</td>
                <td id="localTime"></td>
            </tr>
        </table>
    </div>
</div>

<div id="contentHome" class="content current">
    <h1>Home</h1>
    <p>
        Welcome to the web interface of the <b>Rocket League Map Manager</b> made by Yggdrasil128.
    </p>
    <p>
        This app allows you to easily switch between Rocket League Workshop maps from within the comfort of your
        browser!<br/>
        The app can also automatically start/stop Rocket League, if so desired.
    </p>
    <p>
        In order to function, the app must be aware of the location of the <span class="monospace">steamapps</span>
        folder on your computer, where Rocket League is installed.<br/>
        Once that is configured, the app will automatically scan your Steam workshop folder for any custom maps you have
        downloaded,
        and fetch the latest information about those maps from their respective workshop pages.<br/>
        This is called Map Discovery and can take a few minutes if it runs for the first time, depending on the number
        of maps you have downloaded.
    </p>
    <p>
        From that point on, everything should be fairly self-explanatory.
    </p>
    <p>
        Enjoy! (and GLHF)
    </p>
    <p style="font-size: small; margin-top: 30px;">
        Icons made by <a href="https://smashicons.com/" title="Smashicons">Smashicons</a> from <a
            href="https://www.flaticon.com/" title="Flaticon"> www.flaticon.com</a>
    </p>
</div>

<div id="contentMapList" class="content">
    <table class="mapListHeader">
        <tbody>
        <tr>
            <td class="mapListH1Container">
                <h1>Map List</h1>
            </td>
            <td class="mapLayout" data-children-count="1">
                <div style="margin-bottom: 3px">
                    <label for="mapLayoutSelect" style="font-size: 22px; font-weight: bold;">
                        Layout:
                    </label>
                </div>
                <select id="mapLayoutSelect" style="font-size: 16px" onchange="onUpdateLayoutOption()">
                    <option value="0">Compact List</option>
                    <option value="1" selected>Detailed List</option>
                    <option value="2" disabled>Grid View</option>
                </select>
            </td>
            <td class="mapSorting">
                <label for="mapSortingSelect" style="font-size: 22px; font-weight: bold;">
                    Sort maps by:
                </label>
                <select id="mapSortingSelect" onchange="onUpdateSortOptions()">
                    <optgroup label="Title">
                        <option value="1">Title (A -> Z)</option>
                        <option value="-1">Title (Z -> A)</option>
                    </optgroup>
                    <optgroup label="Last loaded">
                        <option value="2">Last loaded (most recent first)</option>
                        <option value="-2">Last loaded (most recent last)</option>
                    </optgroup>
                    <optgroup label="Map Size">
                        <option value="3">Map Size (largest first)</option>
                        <option value="-3">Map Size (smallest first)</option>
                    </optgroup>
                    <optgroup label="Map ID">
                        <option value="4">Map ID (ascending)</option>
                        <option value="-4">Map ID (descending)</option>
                    </optgroup>
                </select>
                <div class="checkboxContainer">
                    <input id="mapSorting_loadedMapAtTop" type="checkbox" onchange="onUpdateSortOptions()"/>
                    <label for="mapSorting_loadedMapAtTop">Show loaded map at top</label>
                    &emsp;
                    <input id="mapSorting_favoritesAtTop" type="checkbox" onchange="onUpdateSortOptions()"/>
                    <label for="mapSorting_favoritesAtTop">Show favorites at top</label>
                </div>
            </td>
            <td class="actions">
                <button onclick="startMapDiscovery()">Refresh list</button>
                <br/>
                <a href="https://steamcommunity.com/app/252950/workshop/" target="_blank" rel="noreferrer">
                    Visit Rocket League workshop
                </a>
            </td>
        </tr>
        </tbody>
    </table>
    <div id="mapTableContainer">
        Map list is empty.
    </div>
</div>

<div id="contentConfiguration" class="content">
    <h1>Configuration</h1>

    <div id="steamLibrarySetupDiv">
        <h2>Steam Library Setup</h2>
        <p>
            In order for the Map Manager to work, it needs to know the location of the 'steamapps' folder where Rocket
            League is installed.<br/>
            You only need to configure this once, the app will remember these settings afterwards.
        </p>
        <table>
            <tr>
                <td>
                    'steamapps' folder:
                </td>
                <td id="steamappsFolder" class="monospace">
                    &mdash;
                </td>
            </tr>
            <tr>
                <td>
                    RocketLeague.exe file:
                </td>
                <td id="exeFile" class="monospace">
                    &mdash;
                </td>
            </tr>
            <tr>
                <td>
                    Target UPK file:
                </td>
                <td id="upkFile" class="monospace">
                    &mdash;
                </td>
            </tr>
            <tr>
                <td>
                    Workshop folder:
                </td>
                <td id="workshopFolder" class="monospace">
                    &mdash;
                </td>
            </tr>
        </table>

        <div class="buttonContainer one">
            <button onclick="chooseSteamappsFolder(); return false;">Choose steamapps folder</button>
        </div>

        <p class="showOnlyWhenSetupIsNeeded">
            Couldn't find your 'steamapps' folder.<br/>
            Please click this button and enter the path to the 'steamapps' folder where Rocket League is installed.
        </p>
    </div>

    <div id="settingsDiv">
        <form onsubmit="storeConfig(); return false;">
            <h2>Settings</h2>

            <table class="configurationTable">
                <tr>
                    <th>Setting</th>
                    <th>Value</th>
                    <th>Description</th>
                </tr>
                <tr>
                    <td><label for="input_renameOriginalUPK">Rename original Labs_Underpass_P.upk</label></td>
                    <td>
                        <select id="input_renameOriginalUPK" size="1">
                            <option value="0">Disabled</option>
                            <option value="1" selected>Enabled</option>
                        </select>
                    </td>
                    <td>
                        If enabled, the App will rename the original <span class="monospace">Labs_Underpass_P.upk</span>
                        to <span class="monospace">Labs_Underpass_P.upk.UNUSED</span>
                        when a workshop map is loaded, to prevent the "Ambiguous package name" warning from showing up.
                    </td>
                </tr>
                <tr>
                    <td><label for="input_behaviorWhenRLIsStopped">When a map is loaded and Rocket League<br/><b>is not
                        running</b>:</label></td>
                    <td>
                        <select id="input_behaviorWhenRLIsStopped" size="1">
                            <option value="0" selected>Don't start Rocket League</option>
                            <option value="1">Start Rocket League</option>
                        </select>
                    </td>
                    <td>
                        Choose whether or not you'd like the Map Manager to automatically start Rocket League when a map
                        is loaded and Rocket League is not already running.
                    </td>
                </tr>
                <tr>
                    <td><label for="input_behaviorWhenRLIsRunning">When a map is loaded and Rocket League<br/><b>is
                        running</b>:</label></td>
                    <td>
                        <select id="input_behaviorWhenRLIsRunning" size="1">
                            <option value="0">Just load the map</option>
                            <option value="1">Stop Rocket League</option>
                            <option value="2" selected>Stop and restart Rocket League</option>
                        </select>
                    </td>
                    <td>
                        Choose whether or not you'd like the Map Manager to automatically stop/start Rocket League when
                        a map is loaded and Rocket League is already running.
                    </td>
                </tr>
            </table>

            <h2>Advanced Settings</h2>
            <p>Change these only if you know what you are doing.</p>

            <table class="configurationTable">
                <tr>
                    <th>Setting</th>
                    <th>Value</th>
                    <th>Description</th>
                </tr>
                <tr>
                    <td><label for="input_upkFilename">UPK Filename</label></td>
                    <td><input id="input_upkFilename" style="width: 300px" type="text" required></td>
                    <td>
                        The filename of the target UPK file. Default: <span
                            class="monospace">Labs_Underpass_P.upk</span>
                    </td>
                </tr>
                <tr>
                    <td><label for="input_webInterfacePort">Web interface port</label></td>
                    <td><input id="input_webInterfacePort" style="width: 80px" type="number" min="0" max="65536"
                               required></td>
                    <td>
                        The port for the built-in web server. The default port is 16016.<br>
                        You must restart the app for this change to take effect.
                    </td>
                </tr>
            </table>

            <div class="buttonContainer two">
                <button onclick="fillFromConfig(); return false;">Discard changes</button>
                <button id="settingsSubmitButton" type="submit">Store settings</button>
            </div>
        </form>
    </div>

    <div class="buttonContainer three">
        <button id="exitButton" onclick="exitApp(); return false;">Exit RL Map Manager</button>
    </div>
</div>

<div id="disconnectModal" class="modal">
    <div>
        Disconnected from the app.<br>
        Attempting to reconnect...
    </div>
</div>

<div id="mapDiscoveryModal" class="modal">
    <div>
        <h1>Map Discovery</h1>
        <p>
            During Map Discovery, the app scans your Steam workshop folder for any newly downloaded maps
            and fetches the latest information about those maps from their respective Steam workshop page.<br/>
            Depending on the number of maps it has to refresh, this can take up to a few minutes.
        </p>
        <div class="status">
            <span class="message">
                Discovering maps, please wait...
            </span>
            <br/>
            <progress value="0" max="0"></progress>
            <br/>
            <span class="progressText">
                0 %
            </span>
        </div>
        <button onclick="hideMapDiscoveryModal(); return false;">Close</button>
    </div>
</div>

</body>
</html>